---
import Layout from "@/layouts/Layout.astro";
---

<Layout
    title="Unum Examin | Newsletter"
    description="Navigate your spiritual journey with our biweekly insights on reconciliation, contemporary Catholic living, and timeless Church teachings."
    reader={true}
>
    <div class="text-center w-full mt-4 lg:mt-24 md:p-8">
        <h1 class="text-center">Illuminate and break the hooks of sin that have sunken into you.</h1>
        <h3 class="text-center text-2xl p-6 mt-12">
            A bi-weekly Catholic newsletter. 
        </h3>

      <div class="w-full flex justify-center bg-black rounded-xl">
        <div class="flex flex-row flex-wrap justify-center text-xl font-light">
            <div class="flex flex-col items-center w-64 p-6 m-6 rounded-md border-2 border-[--subtle-edge]">
                <img src="/img/draw-chain.jpg" alt="placeholder" class="hidden md:block h-24 w-24 object-cover rounded-lg" />
                <div>Theology of sin, penance, and repentance</div>
            </div>
            <div class="flex flex-col items-center w-64 p-6 m-6 rounded-md border-2 border-[--subtle-edge]">
                <img src="/img/draw-cross.jpg" alt="placeholder" class="hidden md:block h-24 w-24 object-cover rounded-lg" />
                <div>Seasonal themes and Catholic traditions</div>
            </div>
            <div class="flex flex-col items-center w-64 p-6 m-6 rounded-md border-2 border-[--subtle-edge]">
                <img src="/img/draw-barb.jpg" alt="placeholder" class="hidden md:block h-24 w-24 object-cover rounded-lg" />
                <div>Trending worldly influences and snares</div>
            </div>
            <div class="flex flex-col items-center w-64 p-6 m-6 rounded-md border-2 border-[--subtle-edge]">
                <img src="/img/draw-candle.jpg" alt="placeholder" class="hidden md:block h-24 w-24 object-cover rounded-lg" />
                <div>Wisdom from saints and the faithful</div>
            </div>
        </div>
      </div>
        <form id="newsletter-form" class="w-full flex flex-col items-center">
            <div class="m-6 mb-0 flex flex-col items-start">
                <label for="email" class="mb-2">Email</label>
                <input
                    type="email"
                    name="email"
                    id="newsletter-email"
                    placeholder="Enter your email"
                    class="w-72 border-2 rounded-md p-2 bg-transparent"
                    required
                />
                <div class="mt-2 font-light text-sm text-center">Unsubscribe anytime. We won't share your info.</div>
            </div>
           

            <div class="items-center">
                <button data-umami-event="newsletter submit" type="submit" class="bg-[--primary-click] text-white hover:bg-pink-600 focus:bg-pink-500 rounded-lg p-2 mt-4 w-full"
                    >Subscribe</button
                >
            </div>

        </form>
    </div>
</Layout>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('newsletter-form');
    form?.addEventListener('submit', handleSubmit);
});

async function handleSubmit(e: Event) {
    e.preventDefault();
    const emailElement = document.getElementById('newsletter-email') as HTMLInputElement;
    if (!emailElement) {
        alert('Please enter a valid email.');
        return;
    }
    const email = emailElement.value;
    try {
        let response = await fetch('https://workers-subscribe.unumexamen.com/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ email })
        });
        response = await response.json();
        if (response.ok) {
            alert('You have been subscribed.');
            window.location.href = '/';
        } else {
            alert("Whoops, that didn't work. Make sure the address is correct and try again.");
        }
    } catch (error) {
        alert('Sorry, there was an error. Please try again later.');
        console.error('Subscription error:', error);
    }
}
</script>
